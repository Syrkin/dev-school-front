image: docker/compose:latest

services:
  - name: docker:dind
    alias: localhost

stages:
  - build
#  - package
#  - test

cache:
  paths:
    - .gradle/wrapper
    - .gradle/caches

before_script:
  - apk add --update curl && rm -rf /var/cache/apk/*
  - apk add yarn --no-cache --repository http://dl-cdn.alpinelinux.org/alpine/edge/community
  - yarn install
  - apk del yarn
  - apk add openjdk8-jre
  - GRADLE_USER_HOME="$(pwd)/.gradle"
  - export GRADLE_USER_HOME

build:
  stage: build
  script:
    - chmod +x ./gradlew
    - ./gradlew build
  artifacts:
    paths:
      - build/libs/*.jar
    expire_in: 1 week

#docker-package:
#  stage: package
##  tags: ["run03_docker"]
#  script:
#    - docker login -u gitlab-ci-token -p $CI_BUILD_TOKEN registry.gitlab.com
#    - docker build -t registry.gitlab.com/syrkin1/devschool-front-app-server .
#    - docker push registry.gitlab.com/syrkin1/devschool-front-app-server
