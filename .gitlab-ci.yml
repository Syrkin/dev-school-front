image: azul/zulu-openjdk-debian

#services:
#  - name: docker:dind
#    alias: localhost

stages:
  - build
#  - package
#  - test

cache:
  paths:
    - .gradle/wrapper
    - .gradle/caches

before_script:
  - curl -sS https://dl.yarnpkg.com/debian/pubkey.gpg | apt-key add -
  - echo "deb https://dl.yarnpkg.com/debian/ stable main" | tee /etc/apt/sources.list.d/yarn.list
  - apt-get update -qy
  - apt-get install -y nodejs
  - apt-get install -y yarn
  - yarn install --check-files
  - GRADLE_USER_HOME="$(pwd)/.gradle"
  - export GRADLE_USER_HOME

build:
  stage: build
  script:
    - chmod +x ./gradlew
    - ./gradlew build
  artifacts:
    paths:
      - build/libs/*.jar
    expire_in: 1 week

#docker-package:
#  stage: package
##  tags: ["run03_docker"]
#  script:
#    - docker login -u gitlab-ci-token -p $CI_BUILD_TOKEN registry.gitlab.com
#    - docker build -t registry.gitlab.com/syrkin1/devschool-front-app-server .
#    - docker push registry.gitlab.com/syrkin1/devschool-front-app-server
